<html>
    <head>
        <link rel="stylesheet" href="/css/catalogue.css">
    </head>
    <body>
        <%- include('../partials/header', { activeTab: 'collection' }) %>



        <% 
          const uniqueWeapons = [...new Set(items.map(item => item.weapon))];
        %>

        <div class="tab-content">
            <h2>Your Collection</h2>
            <form action="/refreshData" method="POST" style="display: inline;">
                <input type="submit" value="Refresh Data">
            </form>
        </div>

        <div class="DisplayWeapons">
            <h3>Weapons in Your Collection</h3>
            
            <!-- Dropdown to select weapon -->
            <div class="weapon-selector">
                <label for="weaponSelect">Select a Weapon:</label>
                <select id="weaponSelect">
                    <option value="all" selected>All</option> <!-- "All" option as default -->
                    <% uniqueWeapons.forEach(weapon => { %>
                      <option value="<%= weapon %>"><%= weapon %></option>
                    <% }) %>
                </select>
            </div>
            
            <div class="weapons-container">
                <ul>
                    <% items.forEach(item => { %>
                      <li class="weapon-item" data-weapon-name="<%= item.weapon %>">
                        <img src="<%= item.image %>" alt="weapon image" class="weapon-image">
                        <div class="weapon-name"><%= item.weapon %></div>
                        <div class="pattern-name"><%= item.pattern %></div>
                        <div class="rarity-name"><%= item.rarity %></div>
                        <div class="actions">
                          <!-- Add buttons or actions here for managing collection items -->
                          <form action="/delete" method="POST" style="display: inline;">
                            <input type="hidden" name="id" value="<%= item.id %>">
                            <button type="submit">Remove Weapon</button>
                          </form>
                          <a href="/edit/<%= item.id %>">Edit</a>
                        </div>
                      </li>
                    <% }) %>
                </ul>
            </div>
        </div>

        <script>
          const weaponSelect = document.getElementById('weaponSelect');
          const weaponItems = document.querySelectorAll('.weapon-item');

          function filterWeaponsBySelected() {
            const selectedWeapon = weaponSelect.value;
            weaponItems.forEach(item => {
              const itemWeapon = item.getAttribute('data-weapon-name');
              if (selectedWeapon === "all" || itemWeapon === selectedWeapon) {
                item.style.display = 'flex'; // Show item
              } else {
                item.style.display = 'none'; // Hide item
              }
            });
          }

          // Listen to changes on the dropdown
          weaponSelect.addEventListener('change', filterWeaponsBySelected);

          // Filter on page load to show all weapons by default
          document.addEventListener('DOMContentLoaded', filterWeaponsBySelected);
        </script>
    </body>
</html>
