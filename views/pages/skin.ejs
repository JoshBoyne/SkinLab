<html>
    <head>
        <link rel="stylesheet" href="/css/catalogue.css">
        <link rel="stylesheet" href="/css/footer.css" />
    </head>
    <body>
        <%- include('../partials/header', { activeTab: 'list' }) %>

         <!-- weaponNames retrieves all weapon names from collection array uses a set to remove all duplicates and the ... converts the set back to an array.
             this was done so that mulitiple of the same weapon name wouldnt appear in the weapon-selector -->
             <!-- I used the Iterating set section on mdn web docs as well as a post from stackoverflow to get the understanding of ... that converts the set back to an array 
              because without the ... operator the weapon names in the selector are [object Set]-->
              <!-- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set
                    https://stackoverflow.com/questions/63928416/how-does-new-setarray-work-in-javascript -->
        <%  const weaponNames = [...new Set(items.map(item => item.weapon))]; %>

        <div class="DisplayWeapons">
            <h3>Skin Catalogue</h3>
            
             <!-- dropdown box for selecting a weapon -->
            <div class="weapon-selector">
                <label for="weaponSelect">Select a Weapon:</label>
                <select id="weaponSelect">
                   
                    <% weaponNames.forEach(weapon => { %>
                      <option value="<%= weapon %>"><%= weapon %></option>
                    <% }) %>
                </select>
            </div>
            
            <div class="weapons-container">
                <ul>
                    <% items.forEach(item => { %>
                      <li class="weapon-item" data-weapon-name="<%= item.weapon %>">
                        <img src="<%= item.image %>" alt="weapon image" class="weapon-image">
                        <div class="weapon-name"><%= item.weapon %></div>
                        <div class="pattern-name"><%= item.pattern %></div>
                        <div class="actions">
                          <form action="/collection" method="POST" style="display: inline;">
                            <input type="hidden" name="id" value="<%= item.id %>">
                            <button type="submit">Add to Collection</button>
                          </form>
                        </div>
                      </li>
                    <% }) %>
                </ul>
            </div>
        </div>
        <%- include('../partials/footer') %>
        <script>
          const weaponSelect = document.getElementById('weaponSelect');
          const weaponItems = document.querySelectorAll('.weapon-item');

          function filterWeapons() {
            const selectedWeapon = weaponSelect.value;
            weaponItems.forEach(item => {
              const itemWeapon = item.getAttribute('data-weapon-name');
              if (itemWeapon === selectedWeapon) {
                item.style.display = 'flex';  // displays all weapons selected by the combo box/selector
              } else {
                item.style.display = 'none';  //doesnt display any weapon that is not selected by the combo box/selector
              }
            });
          }

          // Listen to changes on the dropdown
          weaponSelect.addEventListener('change', filterWeapons);
        </script>
        </div>
    </body>
</html>
